function NewsPublish(){var e=this;e.pub_btn=$("#pub-news-submit"),e.pub_img=$("#pub-news-img"),e.reminder=$("#info-reminder"),e.news_pub_url="/cms/news_pub/",e.news_img_url="/cms/news_img/"}NewsPublish.prototype.run=function(){var e=this;e.uploadToQiniu(),e.initUEditor(),e.publishNews()},NewsPublish.prototype.initUEditor=function(){window.ue=UE.getEditor("editor",{initialFrameHeight:400,serverUrl:"/ueditor/upload/"})},NewsPublish.prototype.uploadToQiniu=function(){var l=this;$("#pub-news-img").on("change",function(){var u=$(this)[0].files[0];$.ajax({method:"get",url:l.news_img_url,beforeSend:function(e){e.setRequestHeader("X-CSRFToken",Tool.getCookie("csrftoken"))},success:function(e){if(200===e.code){var i=e.data.token,o=u.name.split("."),t=o[o.length-1],n=Date.now()+"."+t,s={region:qiniu.region.z2},r={next:function(e){l.uploadNextAction(e.total)},error:function(e){l.uploadErrorAction(e)},complete:function(e){l.uploadCompleteAction(e)}};qiniu.upload(u,n,i,{mimeType:["image/png","image/jpeg","image/gif","video/mp4"]},s).subscribe(r)}}})})},NewsPublish.prototype.uploadNextAction=function(e){this.showReminder("failed","正在上传..."+e.percent.toFixed()+"%")},NewsPublish.prototype.uploadErrorAction=function(e){var i=this;i.showReminder("failed","上传失败"),setTimeout(function(){i.reminder.removeClass("show")},2e3)},NewsPublish.prototype.uploadCompleteAction=function(e){var i=this,o="http://q9mtei3xj.bkt.clouddn.com/"+e.key;$("#pub-img-url").val(o),i.showReminder("success","图片上传成功"),setTimeout(function(){i.reminder.removeClass("show")},1e3)},NewsPublish.prototype.publishNews=function(){var i=this;function o(e){200===e.code?(i.showReminder("success","文章发布成功！"),setTimeout(function(){window.location.reload()},1e3)):(i.showReminder("failed",e.getErrorMsg()),setTimeout(function(){i.reminder.removeClass("show")},1e3))}i.pub_btn.on("click",function(){var e={title:$("#pub-news-title").val(),category:$("#pub-news-type").val(),thumbnail:$("#pub-img-url").val(),des:$("#pub-news-desc").val(),content:window.ue.getContent()};$.ajax({method:"post",url:i.news_pub_url,data:e,beforeSend:function(e){e.setRequestHeader("X-CSRFToken",Tool.getCookie("csrftoken"))},success:o})})},NewsPublish.prototype.showReminder=function(e,i){var o=this;o.reminder.css("display","block"),"success"===e?o.reminder.removeClass("alert-warning").addClass("show alert-success").text(i):o.reminder.removeClass("alert-success").addClass("show alert-warning").text(i)};var newsPublish=new NewsPublish;newsPublish.run();